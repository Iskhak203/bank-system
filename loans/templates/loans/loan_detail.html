{% extends 'loans/base.html' %}

{% block title %}–ö—Ä–µ–¥–∏—Ç #{{ loan.id }} - –ë–∞–Ω–∫ –°–∏—Å—Ç–µ–º–∞—Å—ã{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px;">
        <div>
            <h2>–ö—Ä–µ–¥–∏—Ç #{{ loan.id }}</h2>
            <p style="color: #666; margin-top: 10px;">
                –ö–∞—Ä–¥–∞—Ä: <strong>{{ loan.customer.full_name }}</strong> | 
                –¢–µ–ª–µ—Ñ–æ–Ω: {{ loan.customer.phone }} |
                –ü–∞—Å–ø–æ—Ä—Ç: {{ loan.customer.passport_number }}
            </p>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 24px; font-weight: bold; color: #667eea;">
                {{ loan.remaining_amount|floatformat:0 }} —Å–æ–º
            </div>
            <div style="color: #666; font-size: 14px;">–ö–∞–ª–≥–∞–Ω —Å—É–º–º–∞</div>
        </div>
    </div>
    
    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
    <div class="progress-bar">
        <div class="progress-fill" style="width: {{ progress_percent }}%;">
            {{ progress_percent|floatformat:0 }}%
        </div>
    </div>
    <p style="text-align: center; color: #666; margin-bottom: 20px;">
        –¢”©–ª”©–Ω–≥”©–Ω: {{ paid_count }} / {{ loan.months }} –∞–π
    </p>
    
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 10px;">
        <div>
            <div style="font-size: 12px; color: #666;">–ë–∞—à—Ç–∞–ø–∫—ã —Å—É–º–º–∞</div>
            <div style="font-size: 20px; font-weight: bold;">{{ loan.total_amount|floatformat:0 }} —Å–æ–º</div>
        </div>
        <div>
            <div style="font-size: 12px; color: #666;">–ü—Ä–æ—Ü–µ–Ω—Ç</div>
            <div style="font-size: 20px; font-weight: bold;">{{ loan.interest_rate }}%</div>
        </div>
        <div>
            <div style="font-size: 12px; color: #666;">–ñ–∞–ª–ø—ã (–ø—Ä–æ—Ü–µ–Ω—Ç –º–µ–Ω–µ–Ω)</div>
            <div style="font-size: 20px; font-weight: bold;">{{ loan.total_with_interest|floatformat:0 }} —Å–æ–º</div>
        </div>
        <div>
            <div style="font-size: 12px; color: #666;">–ê–π–ª—ã–∫ —Ç”©–ª”©–º</div>
            <div style="font-size: 20px; font-weight: bold; color: #2ed573;">{{ loan.monthly_payment|floatformat:0 }} —Å–æ–º</div>
        </div>
        <div>
            <div style="font-size: 12px; color: #666;">–ú”©”©–Ω”©—Ç“Ø</div>
            <div style="font-size: 20px; font-weight: bold;">{{ loan.months }} –∞–π</div>
        </div>
        <div>
            <div style="font-size: 12px; color: #666;">–ë–∞—à—Ç–∞–ª–≥–∞–Ω –∫“Ø–Ω“Ø</div>
            <div style="font-size: 20px; font-weight: bold;">{{ loan.start_date|date:"d.m.Y" }}</div>
        </div>
    </div>
</div>

<div class="card">
    <h3 style="margin-bottom: 20px;">üìÖ –¢”©–ª”©–º –≥—Ä–∞—Ñ–∏–≥–∏</h3>
    <table>
        <thead>
            <tr>
                <th>–ê–π</th>
                <th>–¢”©–ª”©”© –∫“Ø–Ω“Ø</th>
                <th>–°—É–º–º–∞</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–¢”©–ª”©–Ω–≥”©–Ω –∫“Ø–Ω“Ø</th>
                <th>–ê—Ä–∞–∫–µ—Ç</th>
            </tr>
        </thead>
        <tbody>
            {% for schedule in schedules %}
            <tr class="payment-row {% if schedule.is_paid %}paid{% endif %}">
                <td>–ê–π {{ schedule.month_number }}</td>
                <td>{{ schedule.due_date|date:"d.m.Y" }}</td>
                <td><strong>{{ schedule.amount|floatformat:0 }} —Å–æ–º</strong></td>
                <td>
                    {% if schedule.is_paid %}
                        <span class="status-badge status-paid">‚úì –¢”©–ª”©–Ω–≥”©–Ω</span>
                    {% else %}
                        <span class="status-badge status-pending">‚è≥ –ö“Ø—Ç“Ø–ª“Ø“Ø–¥”©</span>
                    {% endif %}
                </td>
                <td>
                    {% if schedule.paid_date %}
                        {{ schedule.paid_date|date:"d.m.Y H:i" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if schedule.is_paid %}
                        <button class="payment-btn paid" disabled>–¢”©–ª”©–Ω“Ø</button>
                    {% else %}
                        <form method="post" action="{% url 'make_payment' schedule.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="payment-btn pending">–¢”©–ª”©”©</button>
                        </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="margin-top: 20px;">
    <a href="{% url 'dashboard' %}" class="btn btn-primary">‚Üê –ë–∞—à–∫—ã –±–µ—Ç–∫–µ –∫–∞–π—Ç—É—É</a>
</div>
{% endblock %}